<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ¥” ë™ê¸€ëœë“œ ìš”ë¦¬ì‚¬ ë¶„ì„ê¸° ğŸ¥•</title>
    <style>
        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #1a1a1a; color: #e0e0e0; padding: 20px; display: flex; flex-direction: column; align-items: center; font-size: 16px; }
        .container { background: #262626; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); width: 95%; max-width: 900px; border: 1px solid #333; position: relative; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-wrapper { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid #444; padding-bottom: 15px; width: 100%; justify-content: center; }
        .tab-btn { background: #333; border: none; color: #888; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 17px; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: #ffca28; color: #000; box-shadow: 0 0 15px rgba(255, 202, 40, 0.4); }
        .tab-content { display: none; width: 100%; }
        .tab-content.active { display: block; }

        h2 { text-align: center; color: #ffffff; margin-bottom: 30px; font-size: 28px; letter-spacing: -1px; }
        h3 { font-size: 19px; color: #fff; margin: 30px 0 15px 5px; display: flex; align-items: center; }

        /* [íƒ­ 1: ìš”ë¦¬ ì‹œì„¸ ë¶„ì„ê¸°] */
        .btn-clear { position: absolute; top: 20px; right: 20px; padding: 6px 12px; background: #3d3d3d; color: #bbb; border: 1px solid #555; border-radius: 6px; font-size: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-clear:hover { background: #f04747; color: white; border-color: #f04747; }
        textarea { width: 100%; height: 110px; border: 1px solid #444; border-radius: 12px; padding: 15px; background: #1e1e1e; color: #eee; margin-bottom: 15px; resize: none; box-sizing: border-box; font-size: 15px; }
        .btn-analyze { width: 100%; padding: 12px; background: #eeeeee; color: #1a1a1a; border: none; border-radius: 10px; font-size: 18px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-bottom: 10px; box-shadow: 0 3px 0 #bcbcbc; }
        .btn-analyze:hover { background: #ffffff; transform: translateY(-1px); box-shadow: 0 4px 0 #bcbcbc; }
        #timestamp { text-align: center; color: #777; font-size: 13px; margin-bottom: 15px; }
        
        .tier-section { margin-top: 20px; border-radius: 15px; background: #2d2d2d; padding: 15px; border: 1px solid #3d3d3d; text-align: left; }
        .item-row { padding: 10px; border-bottom: 1px solid #383838; font-size: 16px; line-height: 1.5; text-align: left; padding-left: 15px; }
        
        .max-name { color: #ffb7ce; font-weight: bold; text-shadow: 0 0 12px rgba(255, 183, 206, 0.8); animation: pink-glow 1.5s infinite alternate; }
        .minus1-name { color: #fff4a3; font-weight: bold; text-shadow: 0 0 10px rgba(255, 244, 163, 0.7); animation: yellow-glow 1.5s infinite alternate; }
        .minus2-name { color: #a7ffeb; font-weight: bold; text-shadow: 0 0 12px rgba(167, 255, 235, 0.8); animation: cyan-glow 1.5s infinite alternate; }
        @keyframes pink-glow { 0% { text-shadow: 0 0 5px rgba(255, 183, 206, 0.4); } 100% { text-shadow: 0 0 18px rgba(255, 183, 206, 1); } }
        @keyframes yellow-glow { 0% { text-shadow: 0 0 5px rgba(255, 244, 163, 0.4); } 100% { text-shadow: 0 0 18px rgba(255, 244, 163, 1); } }
        @keyframes cyan-glow { 0% { text-shadow: 0 0 5px rgba(167, 255, 235, 0.4); } 100% { text-shadow: 0 0 18px rgba(167, 255, 235, 1); } }
        .symbol-info { color: #ffffff; font-weight: bold; }
        .empty-msg { color: #aaa; font-style: italic; font-size: 14px; text-align: center; padding: 10px; }

        /* [íƒ­ 2, 3: ë””ìì¸] */
        .neon-pink { color: #ff007f; text-shadow: 0 0 8px #ff007f, 0 0 20px #ff007f; font-weight: bold; }
        .neon-cyan { color: #00e5ff; text-shadow: 0 0 8px #00e5ff, 0 0 20px #00e5ff; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; background: #1e1e1e; border-radius: 12px; overflow: hidden; font-size: 15px; table-layout: fixed; margin-bottom: 20px; }
        th { background: #333; color: #ccc; padding: 12px 5px; font-weight: 600; border-bottom: 2px solid #444; }
        td { padding: 12px 5px; border-bottom: 1px solid #333; text-align: center; color: #eee; }
        input { width: 85%; background: #2d2d2d; border: 1px solid #444; color: #fff; text-align: right; padding: 8px 10px; border-radius: 8px; font-size: 16px; font-weight: bold; }
        .highlight { color: #ffffff; font-weight: bold; }
        .unit-text { font-size: 13px; color: #888; margin-left: 2px; }
        .special-label { font-size: 11px; color: #ff9e9e; display: block; margin-top: 4px; }
        .sub-row td { background: #222; font-size: 12px; color: #aaa; padding: 8px 5px; }
        .sub-label { color: #888; margin-right: 4px; }
        .sub-val { color: #bbb; font-weight: bold; }
        .gap { margin-right: 15px; }
        .price-main { color: #fff4a3 !important; }
        .tier-title { font-size: 22px; font-weight: bold; margin: 25px 0 10px 5px; color: #ffca28; border-left: 5px solid #ffca28; padding-left: 10px; }
        .recipe-name-td { text-align: left !important; padding-left: 15px !important; font-weight: bold; font-size: 16px; } 
        .minor-col { color: #777 !important; font-size: 13px !important; text-align: left !important; padding-left: 20px !important; }
        .rank-col { width: 60px; font-weight: bold; }
        .rank-1-row { background: rgba(255, 215, 0, 0.12) !important; }
        .rank-1-row .rank-text { color: #ffd700; text-shadow: 0 0 10px #ffd700; font-size: 16px; font-weight: 900; }
        .rank-2-row { background: rgba(192, 192, 192, 0.08) !important; }
        .rank-2-row .rank-text { color: #e0e0e0; text-shadow: 0 0 8px #e0e0e0; }
        .rank-3-row { background: rgba(205, 127, 50, 0.08) !important; }
        .rank-3-row .rank-text { color: #cd7f32; text-shadow: 0 0 8px #cd7f32; }
        .profit-val { color: #50ffab; font-weight: bold; font-size: 16px; }
        .hour-val { color: #fff4a3; font-weight: bold; font-size: 18px; }
        .recipe-info { font-size: 11px; color: #999; margin-left: 5px; }
    </style>
</head>
<body>

<div class="container">
    <button class="btn-clear" onclick="clearAllAnalysis()">ì´ˆê¸°í™” ğŸ§¹</button>
    <h2>ğŸ¥” ë™ê¸€ëœë“œ ìš”ë¦¬ì‚¬ ë¶„ì„ê¸° ğŸ¥•</h2>
    
    <div class="tab-wrapper">
        <button class="tab-btn active" onclick="openTab(event, 'marketTab')">ìš”ë¦¬ ì‹œì„¸ ë¶„ì„ê¸°</button>
        <button class="tab-btn" onclick="openTab(event, 'priceTab')">ìš”ë¦¬ ë‹¨ê°€ ë¶„ì„ê¸°</button>
        <button class="tab-btn" onclick="openTab(event, 'profitTab')">ìš”ë¦¬ ìˆ˜ìµ ìˆœìœ„í‘œ</button>
    </div>

    <div id="marketTab" class="tab-content active">
        <textarea id="inputText" placeholder="ë””ìŠ¤ì½”ë“œ ì‹œì„¸ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!"></textarea>
        <button class="btn-analyze" onclick="analyzePrice()">ê°€ì˜¨ì•„ ê³ ì  ì•ˆëœ¨ë©´ ì•Œì§€? ğŸš€</button>
        <div id="timestamp"></div>
        <div id="resultArea"></div>
    </div>

    <div id="priceTab" class="tab-content">
        <h3>ë†ì‘ë¬¼ &amp; ë¶€ì¬ë£Œ [ìƒì <span class="neon-pink">1ì…œì»¤</span> ê¸°ì¤€]</h3>
        <table>
            <thead><tr><th style="width: 25%;">ì¬ë£Œëª…</th><th style="width: 20%;">ë§¤ì…ê°€</th><th style="width: 15%;">1ê°œ</th><th style="width: 20%;">32ê°œ</th><th class="price-main">64ê°œ</th></tr></thead>
            <tbody id="groupABody"></tbody>
        </table>
        <h3>í•´ì‚°ë¬¼ [ìƒì <span class="neon-cyan">1ì„¸íŠ¸</span> ê¸°ì¤€]</h3>
        <table>
            <thead><tr><th style="width: 25%;">ì¬ë£Œëª…</th><th style="width: 20%;">ë§¤ì…ê°€</th><th style="width: 15%;">ìƒì 1ê°œ</th><th style="width: 20%;">32ê°œ</th><th class="price-main">64ê°œ</th></tr></thead>
            <tbody id="groupBBody"></tbody>
        </table>
    </div>

    <div id="profitTab" class="tab-content">
        <div id="tierContainer"></div>
    </div>
</div>

<script>
/* [ë°ì´í„° ì •ì˜] */
const cookData = {
    "íƒ€ì½”": { tier: 1, max: 51 }, "í•´ë¬¼ì¹´ë ˆ": { tier: 1, max: 34 }, "ê³ êµ¬ë§ˆ ë§›íƒ•": { tier: 1, max: 51 }, "ê³ êµ¬ë§ˆë§›íƒ•": { tier: 1, max: 51 },
    "ë² ì´ê¸€": { tier: 1, max: 51 }, "ê³ ë¡œì¼€": { tier: 1, max: 22 }, "ë¯¸íŠ¸ë³¼": { tier: 1, max: 51 }, "ë¬´íŠ¸ë³¼": { tier: 1, max: 51 },
    "ê°ìíŠ€ê¹€": { tier: 2, max: 80 }, "ì½˜ ë§ˆì¹´ë¡œë‹ˆ": { tier: 2, max: 85 }, "ì½˜ë§ˆì¹´ë¡œë‹ˆ": { tier: 2, max: 85 }, "ì†Œê³ ê¸°ë¯¸ì—­êµ­": { tier: 2, max: 74 },
    "ë¼ë©´": { tier: 2, max: 85 }, "ë¸Œë¦¬ë˜": { tier: 2, max: 80 },
    "ìŠ¤í…Œì´í¬": { tier: 3, max: 80 }, "ì „ë³µì£½": { tier: 3, max: 97 }, "ì™€í”Œ": { tier: 3, max: 85 }, "ë§ˆëŠ˜ë¹µ": { tier: 3, max: 85 },
    "ë¸”ë£¨ë² ë¦¬ ì¹˜ì¦ˆì¼€ì´í¬": { tier: 3, max: 80 }, "ë¸”ë£¨ë² ë¦¬ì¹˜ì¦ˆì¼€ì´í¬": { tier: 3, max: 80 },
    "í•«ë„ê·¸": { tier: 4, max: 142 }, "ê³ êµ¬ë§ˆ íŒ¬ì¼€ì´í¬": { tier: 4, max: 89 }, "ê³ êµ¬ë§ˆíŒ¬ì¼€ì´í¬": { tier: 4, max: 89 },
    "íì‹  ì˜¤ë¯ˆë ›": { tier: 4, max: 89 }, "íì‹ ì˜¤ë¯ˆë ›": { tier: 4, max: 89 }, "í™í•©íŒŒìŠ¤íƒ€": { tier: 4, max: 149 },
    "ë¡œìŠ¤íŠ¸ ì¹˜í‚¨": { tier: 4, max: 89 }, "ë¡œìŠ¤íŠ¸ì¹˜í‚¨": { tier: 4, max: 89 }, "ê³¼ì¼ ì¼€ì´í¬": { tier: 4, max: 89 },
    "ê³¼ì¼ì¼€ì´í¬": { tier: 4, max: 89 }, "ìƒŒë“œìœ„ì¹˜": { tier: 4, max: 142 }
};

const groupA_Config = [
    { name: "ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬", conv: 15552, initial: 270000, hasSub: true },
    { name: "íŒŒ/ë§ˆëŠ˜/ì˜¥ìˆ˜ìˆ˜/ë”¸ê¸°", conv: 15552, initial: 432000, hasSub: true },
    { name: "í† ë§ˆí† /ì–‘ìƒì¶”", conv: 15552, initial: 756000, hasSub: true },
    { name: "ê°ì ìƒì", conv: 1728, initial: 0 }, { name: "ë‹¹ê·¼ ìƒì", conv: 1728, initial: 0 },
    { name: "ë¹„íŠ¸ ìƒì", conv: 1728, initial: 14000 }, { name: "ì—´ë§¤ ìƒì", conv: 1728, initial: 17000 },
    { name: "ê±´ì´ˆ", conv: 5184, initial: 34000, label: "ë°˜ì£½ 5184ê°œ ê¸°ì¤€" }, { name: "ìƒê³ ê¸°", conv: 8640, initial: 55000, label: "ê°€ê³µê³ ê¸° 8640ê°œ ê¸°ì¤€" },
    { name: "ê°€ê³µ ìš°ìœ ", conv: 1728, initial: 0 }, { name: "ê°€ê³µ ì¹˜ì¦ˆ", conv: 1728, initial: 0 }, { name: "í˜¸ë°•", conv: 1728, initial: 3000 }
];

const groupB_Config = [
    { name: "êµ´", initial: 12600 }, { name: "ë¯¸ì—­", initial: 13000 }, { name: "ì „ë³µ", initial: 18000 }, { name: "í™í•©", initial: 30000 }
];

const recipes = [
    { tier: 1, name: "ë¬´íŠ¸ë³¼", sell: 51, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":2, "ë‹¹ê·¼ ìƒì":2}, txt: "ë¬´2 ë‹¹ê·¼2" },
    { tier: 1, name: "ê³ êµ¬ë§ˆ ë§›íƒ•", sell: 51, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":2, "ê°ì ìƒì":2}, txt: "ê³ êµ¬ë§ˆ2 ê°ì2" },
    { tier: 1, name: "ë² ì´ê¸€", sell: 51, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":2, "ê±´ì´ˆ":2}, txt: "ë¬´2 ë°˜ì£½2" },
    { tier: 1, name: "íƒ€ì½”", sell: 51, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":2, "ê±´ì´ˆ":2}, txt: "ì½©2 ë°˜ì£½2" },
    { tier: 1, name: "í•´ë¬¼ì¹´ë ˆ", sell: 34, ing: {"êµ´":2, "ë‹¹ê·¼ ìƒì":1}, txt: "êµ´2 ë‹¹ê·¼1" },
    { tier: 1, name: "ê³ ë¡œì¼€", sell: 22, ing: {"ê°ì ìƒì":2, "ë‹¹ê·¼ ìƒì":2}, txt: "ê°ì2 ë‹¹ê·¼2" },
    { tier: 2, name: "ë¼ë©´", sell: 85, ing: {"íŒŒ/ë§ˆëŠ˜/ì˜¥ìˆ˜ìˆ˜/ë”¸ê¸°":2, "ë¹„íŠ¸ ìƒì":1, "ìƒê³ ê¸°":1}, txt: "íŒŒ2 ë¹„íŠ¸1 ê³ ê¸°1" },
    { tier: 2, name: "ì½˜ ë§ˆì¹´ë¡œë‹ˆ", sell: 85, ing: {"íŒŒ/ë§ˆëŠ˜/ì˜¥ìˆ˜ìˆ˜/ë”¸ê¸°":2, "ë¹„íŠ¸ ìƒì":1, "ê°€ê³µ ìš°ìœ ":1}, txt: "ì˜¥ìˆ˜ìˆ˜2 ë¹„íŠ¸1 ìš°ìœ 1" },
    { tier: 2, name: "ê°ìíŠ€ê¹€", sell: 80, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ê°ì ìƒì":1, "ìƒê³ ê¸°":1}, txt: "ê³ êµ¬ë§ˆ3 ê°ì1 ê³ ê¸°1" },
    { tier: 2, name: "ë¸Œë¦¬ë˜", sell: 80, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ê±´ì´ˆ":1, "ê°€ê³µ ì¹˜ì¦ˆ":1}, txt: "ë¬´3 ë°˜ì£½1 ì¹˜ì¦ˆ1" },
    { tier: 2, name: "ì†Œê³ ê¸°ë¯¸ì—­êµ­", sell: 74, ing: {"ë¯¸ì—­":2, "ê°ì ìƒì":1, "ìƒê³ ê¸°":1}, txt: "ë¯¸ì—­2 ê°ì1 ê³ ê¸°1" },
    { tier: 3, name: "ì „ë³µì£½", sell: 97, ing: {"ì „ë³µ":2, "ë‹¹ê·¼ ìƒì":1, "ìƒê³ ê¸°":1}, txt: "ì „ë³µ2 ë‹¹ê·¼1 ê³ ê¸°1" },
    { tier: 3, name: "ì™€í”Œ", sell: 85, ing: {"íŒŒ/ë§ˆëŠ˜/ì˜¥ìˆ˜ìˆ˜/ë”¸ê¸°":2, "í˜¸ë°•":1, "ê°€ê³µ ìš°ìœ ":1}, txt: "ë”¸ê¸°2 í˜¸ë°•1 ìš°ìœ 1" },
    { tier: 3, name: "ë§ˆëŠ˜ë¹µ", sell: 85, ing: {"íŒŒ/ë§ˆëŠ˜/ì˜¥ìˆ˜ìˆ˜/ë”¸ê¸°":2, "í˜¸ë°•":1, "ìƒê³ ê¸°":1}, txt: "ë§ˆëŠ˜2 í˜¸ë°•1 ê³ ê¸°1" },
    { tier: 3, name: "ìŠ¤í…Œì´í¬", sell: 80, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ê°ì ìƒì":1, "ìƒê³ ê¸°":1}, txt: "ë¬´3 ê°ì1 ê³ ê¸°1" },
    { tier: 3, name: "ë¸”ë£¨ë² ë¦¬ ì¹˜ì¦ˆì¼€ì´í¬", sell: 80, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ê±´ì´ˆ":1, "ê°€ê³µ ì¹˜ì¦ˆ":1}, txt: "ë¸”ë£¨ë² ë¦¬3 ë°˜ì£½1 ì¹˜ì¦ˆ1" },
    { tier: 4, name: "í™í•© íŒŒìŠ¤íƒ€", sell: 149, ing: {"í™í•©":2, "ê°ì ìƒì":1, "ê°€ê³µ ì¹˜ì¦ˆ":1}, txt: "í™í•©2 ê°ì1 ì¹˜ì¦ˆ1" },
    { tier: 4, name: "í•«ë„ê·¸", sell: 142, ing: {"í† ë§ˆí† /ì–‘ìƒì¶”":2, "ì—´ë§¤ ìƒì":1, "ìƒê³ ê¸°":1}, txt: "ì–‘ìƒì¶”2 ì—´ë§¤1 ê³ ê¸°1" },
    { tier: 4, name: "ìƒŒë“œìœ„ì¹˜", sell: 142, ing: {"í† ë§ˆí† /ì–‘ìƒì¶”":2, "ì—´ë§¤ ìƒì":1, "ê°€ê³µ ì¹˜ì¦ˆ":1}, txt: "í† ë§ˆí† 2 ì—´ë§¤1 ì¹˜ì¦ˆ1" },
    { tier: 4, name: "ê³ êµ¬ë§ˆ íŒ¬ì¼€ì´í¬", sell: 89, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ê±´ì´ˆ":1, "ìƒê³ ê¸°":1}, txt: "ê³ êµ¬ë§ˆ3 ë°˜ì£½1 ê³ ê¸°1" },
    { tier: 4, name: "íì‹  ì˜¤ë¯ˆë ›", sell: 89, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ë¹„íŠ¸ ìƒì":1, "ê°€ê³µ ì¹˜ì¦ˆ":1}, txt: "ë¬´3 ë¹„íŠ¸1 ì¹˜ì¦ˆ1" },
    { tier: 4, name: "ë¡œìŠ¤íŠ¸ ì¹˜í‚¨", sell: 89, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ê°ì ìƒì":1, "ìƒê³ ê¸°":1}, txt: "ì½©3 ê°ì1 ê³ ê¸°1" },
    { tier: 4, name: "ê³¼ì¼ ì¼€ì´í¬", sell: 89, ing: {"ê³ êµ¬ë§ˆ/ë¬´/ì½©/ë¸”ë£¨ë² ë¦¬":3, "ë‹¹ê·¼ ìƒì":1, "ê°€ê³µ ìš°ìœ ":1}, txt: "ë¸”ë£¨ë² ë¦¬3 ë‹¹ê·¼1 ìš°ìœ 1" }
];

let unitPrices = {};

function openTab(evt, tabName) {
    const contents = document.getElementsByClassName("tab-content");
    for (let i = 0; i < contents.length; i++) contents[i].classList.remove("active");
    const btns = document.getElementsByClassName("tab-btn");
    for (let i = 0; i < btns.length; i++) btns[i].classList.remove("active");
    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");
}

function clearAllAnalysis() {
    document.getElementById('inputText').value = "";
    document.getElementById('resultArea').innerHTML = "";
    document.getElementById('timestamp').innerHTML = "";
}

function analyzePrice() {
    const text = document.getElementById('inputText').value;
    const regex = /\[(.+?)\]\s*\|\s*\d+\s*â†’\s*(\d+)/g;
    let results = { 1: [], 2: [], 3: [], 4: [] };
    let match;
    const now = new Date();
    const timeString = `${now.getFullYear()}ë…„ ${String(now.getMonth() + 1).padStart(2, '0')}ì›” ${String(now.getDate()).padStart(2, '0')}ì¼ ${now.getHours() >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „'} ${now.getHours() % 12 || 12}ì‹œ ${String(now.getMinutes()).padStart(2, '0')}ë¶„ ê¸°ì¤€`;
    document.getElementById('timestamp').innerHTML = timeString + " <<";
    while ((match = regex.exec(text)) !== null) {
        let name = match[1].trim();
        let currPrice = parseInt(match[2]);
        if (cookData[name]) {
            let target = cookData[name];
            let htmlContent = "";
            if (currPrice === target.max) htmlContent = `<span class="max-name">â­ ${name}</span> <span class="symbol-info">ã€Œ ğŸ’•ìµœê³ ê°€ğŸ’•ï½œ${currPrice} ã€</span>`;
            else if (currPrice === target.max - 1) htmlContent = `<span class="minus1-name">â­ ${name}</span> <span class="symbol-info">ã€Œ -1 ì›ï½œ${currPrice} ã€</span>`;
            else if (currPrice === target.max - 2) htmlContent = `<span class="minus2-name">â­ ${name}</span> <span class="symbol-info">ã€Œ -2 ì›ï½œ${currPrice} ã€</span>`;
            if (htmlContent !== "") results[target.tier].push(htmlContent);
        }
    }
    renderMarketResults(results);
}

function renderMarketResults(data) {
    let html = "";
    for (let i = 1; i <= 4; i++) {
        html += `<div class="tier-section"><div class="tier-title" style="border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 10px; border-left:none; margin:0; padding-left:0; font-size:18px; text-align:left;">${i}ì°¨ ìš”ë¦¬</div>`;
        if (data[i].length === 0) html += `<div class="empty-msg">ê¸°ë‹¤ë¦¼ì˜ ë¯¸í•™... ê³ ì ì•„ í˜ë‚´ì ( â€¢Ì€ Ï‰ â€¢Ì )</div>`;
        else data[i].forEach(itemHtml => { html += `<div class="item-row">${itemHtml}</div>`; });
        html += `</div>`;
    }
    document.getElementById('resultArea').innerHTML = html;
}

function formatVal(num) { return num === 0 ? "0" : Number(num.toFixed(2)).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 }); }
function formatRound(num) { return Math.round(num).toLocaleString(); }

function handleInput(el, type, name) {
    let rawVal = el.value.replace(/[^0-9]/g, '');
    if (rawVal === "") rawVal = "0";
    el.value = parseInt(rawVal).toLocaleString();
    const numericVal = parseInt(rawVal);
    if (type === 'A') calculateA(name, numericVal);
    else calculateB(name, numericVal);
    updateProfits();
}

function calculateA(name, price) {
    const safeId = name.replace(/\//g, '').replace(/ /g, '');
    const row = document.getElementById(`row-${safeId}`);
    const config = groupA_Config.find(m => m.name === name);
    const unitPrice = price / config.conv;
    unitPrices[name] = unitPrice;
    row.querySelector('.val-1').innerText = formatVal(unitPrice);
    row.querySelector('.val-32').innerText = formatVal(unitPrice * 32);
    row.querySelector('.val-64').innerText = formatVal(unitPrice * 64);
    if (config.hasSub) {
        const subRow = document.getElementById(`sub-${safeId}`);
        subRow.querySelector('.val-set1').innerText = formatVal(price / 27);
        subRow.querySelector('.val-set3').innerText = formatVal(price / 9);
    }
}

function calculateB(name, price) {
    const safeId = name.replace(/ /g, '');
    const row = document.getElementById(`row-${safeId}`);
    const price64 = price / 9; 
    const unitPrice = price64 / 64;
    unitPrices[name] = unitPrice;
    row.querySelector('.val-box1').innerText = formatVal(unitPrice * 9);
    row.querySelector('.val-32').innerText = formatVal(unitPrice * 32);
    row.querySelector('.val-64').innerText = formatVal(price64);
    const subRow = document.getElementById(`sub-b-${safeId}`);
    subRow.querySelector('.val-set3').innerText = formatVal(price * 3);
    subRow.querySelector('.val-line1').innerText = formatVal(price * 9);
    subRow.querySelector('.val-line2').innerText = formatVal(price * 18);
    subRow.querySelector('.val-shulker').innerText = formatVal(price * 27);
}

function updateProfits() {
    const container = document.getElementById('tierContainer');
    container.innerHTML = '';
    for (let t = 1; t <= 4; t++) {
        const tierRecipes = recipes.filter(r => r.tier === t).map(r => {
            let unitCost = 0;
            for (let ing in r.ing) unitCost += (unitPrices[ing] || 0) * r.ing[ing];
            const cost32 = unitCost * 32;
            const profit32 = (r.sell * 32) - cost32;
            return { ...r, cost32, profit32, hourProfit: profit32 * 24 };
        }).sort((a, b) => b.profit32 - a.profit32);

        const section = document.createElement('div');
        section.innerHTML = `<div class="tier-title">${t}ì°¨ ìš”ë¦¬ ìˆœìœ„</div>
            <table><thead><tr><th class="rank-col">ìˆœìœ„</th><th style="width:23%">ìš”ë¦¬ëª…</th><th style="width:28%">ìµœê³  íŒë§¤ê°€/ìš”ë¦¬ 1íšŒ ì¬ë£Œì›ê°€</th><th>1íšŒ ìˆœìˆ˜ìµ</th><th style="color:#ffca28">1ì‹œê°„ ìˆœìˆ˜ìµ</th></tr></thead>
            <tbody>${tierRecipes.map((r, idx) => {
                const rank = idx + 1;
                const rowClass = rank <= 3 ? `rank-${rank}-row` : '';
                return `<tr class="${rowClass}"><td class="rank-col"><span class="rank-text">${rank}ìœ„</span></td>
                    <td class="recipe-name-td">${r.name}<span class="recipe-info">(${r.txt})</span></td>
                    <td class="minor-col">${r.sell} / ${formatRound(r.cost32)}</td>
                    <td class="profit-val">${formatRound(r.profit32)}ì›</td>
                    <td class="hour-val">${formatRound(r.hourProfit)}ì›</td></tr>`;
            }).join('')}</tbody></table>`;
        container.appendChild(section);
    }
}

function init() {
    const aBody = document.getElementById('groupABody');
    groupA_Config.forEach(m => {
        const safeId = m.name.replace(/\//g, '').replace(/ /g, '');
        const tr = document.createElement('tr');
        tr.id = `row-${safeId}`;
        tr.innerHTML = `<td style="text-align:left; padding-left:15px;"><b>${m.name}</b>${m.label ? `<span class="special-label">${m.label}</span>` : ''}</td>
            <td><input type="text" value="${m.initial.toLocaleString()}" oninput="handleInput(this, 'A', '${m.name}')"></td>
            <td><span class="val-1 highlight">0</span><span class="unit-text">ì›</span></td>
            <td><span class="val-32 highlight">0</span><span class="unit-text">ì›</span></td>
            <td><span class="val-64 highlight price-main">0</span><span class="unit-text">ì›</span></td>`;
        aBody.appendChild(tr);
        if (m.hasSub) {
            const subTr = document.createElement('tr');
            subTr.id = `sub-${safeId}`; subTr.className = 'sub-row';
            subTr.innerHTML = `<td colspan="2"></td><td colspan="3" style="text-align:left; padding-left:15px;"><span class="gap"><span class="sub-label">ìƒì 1ì„¸íŠ¸:</span><span class="val-set1 sub-val">0</span>ì›</span><span class="gap"><span class="sub-label">ìƒì 3ì„¸íŠ¸:</span><span class="val-set3 sub-val">0</span>ì›</span></td>`;
            aBody.appendChild(subTr);
        }
        calculateA(m.name, m.initial);
    });
    const bBody = document.getElementById('groupBBody');
    groupB_Config.forEach(item => {
        const safeId = item.name.replace(/ /g, '');
        const tr = document.createElement('tr');
        tr.id = `row-${safeId}`;
        tr.innerHTML = `<td style="text-align:left; padding-left:15px;"><b>${item.name}</b></td>
            <td><input type="text" value="${item.initial.toLocaleString()}" oninput="handleInput(this, 'B', '${item.name}')"></td>
            <td><span class="val-box1 highlight">0</span><span class="unit-text">ì›</span></td>
            <td><span class="val-32 highlight">0</span><span class="unit-text">ì›</span></td>
            <td><span class="val-64 highlight price-main">0</span><span class="unit-text">ì›</span></td>`;
        bBody.appendChild(tr);
        const subTr = document.createElement('tr');
        subTr.id = `sub-b-${safeId}`; subTr.className = 'sub-row';
        subTr.innerHTML = `<td colspan="2"></td><td colspan="3" style="text-align:left; padding-left:15px;"><span class="gap"><span class="sub-label">3ì„¸íŠ¸:</span><span class="val-set3 sub-val">0</span>ì›</span><span class="gap"><span class="sub-label">9ì„¸íŠ¸:</span><span class="val-line1 sub-val">0</span>ì›</span><span class="gap"><span class="sub-label">18ì„¸íŠ¸:</span><span class="val-line2 sub-val">0</span>ì›</span><span class="gap"><span class="sub-label">1ì…œì»¤:</span><span class="val-shulker sub-val">0</span>ì›</span></td>`;
        bBody.appendChild(subTr);
        calculateB(item.name, item.initial);
    });
    updateProfits();
}
init();
</script>
</body>
</html>
